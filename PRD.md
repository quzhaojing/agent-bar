# Agent Bar - 产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品名称
Agent Bar - 智能文本增强工具

### 1.2 产品定位
一个浏览器/编辑器插件，为用户提供基于多种LLM模型的文本处理和增强功能，通过可配置的工具栏快速访问AI能力。

### 1.3 目标用户
- 内容创作者
- 程序员
- 学生和研究人员
- 需要频繁处理文本的专业人士

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 LLM模型配置管理
**功能描述**：用户可以配置和管理多个LLM服务提供商

**具体要求**：
- 支持的LLM服务商：
  - OpenAI (GPT系列)
  - Anthropic Claude
  - Google Gemini
  - DeepSeek
  - 阿里云通义千问 (Qwen)
  - 智谱清言 (GLM)
  - 其他自定义API端点

- 配置项包括：
  - 服务商名称
  - API地址/端点
  - API密钥
  - 模型名称
  - 其他必要参数（如温度、最大token数等）

- 功能特性：
  - 支持多个服务商同时配置
  - 可以设置默认服务商
  - 支持API连接测试
  - 支持导入/导出配置

#### 2.1.2 URL匹配规则配置
**功能描述**：用户可以配置工具栏在哪些网站上显示，支持基于host和host+uri的匹配规则

**具体要求**：
- 匹配规则类型：
  - Host匹配：仅基于域名匹配（如 `github.com`）
  - Host+URI匹配：基于域名和路径的精确匹配（如 `github.com/user/repo`）
  - 通配符支持：支持 `*` 作为通配符（如 `*.github.com`）
  - 正则表达式：高级用户可使用正则表达式匹配

- 配置界面：
  - 规则列表管理（添加/编辑/删除）
  - 规则优先级设置
  - 规则启用/禁用开关
  - 规则测试工具（输入URL测试是否匹配）

- 预设规则库：
  - 常用网站预设模板
  - 开发者工具相关网站
  - 内容创作平台
  - 文档和知识库网站

- 匹配逻辑：
  - 支持多条规则同时生效
  - 规则按优先级匹配
  - 支持黑白名单模式
  - 实时匹配状态显示

#### 2.1.3 文本选择与工具栏显示
**功能描述**：当用户选中文本且当前页面匹配URL规则时，在选中区域正上方显示工具栏

**具体要求**：
- 触发条件：
  - 当前页面URL匹配至少一条激活的规则
  - 用户选中文本且文本长度 > 0
  - 工具栏在选中文本上方200px处显示
  - 工具栏不应遮挡原文本内容

- 工具栏特性：
  - 响应式设计，适配不同屏幕尺寸
  - 智能定位，避免超出屏幕边界
  - 选中文本变化时工具栏位置实时更新
  - 取消选择时工具栏自动隐藏
  - 根据匹配规则显示对应的工具栏配置

#### 2.1.4 可配置工具栏
**功能描述**：用户可以在设置页面自定义工具栏按钮

**具体要求**：
- 按钮配置项：
  - 按钮名称/显示文本
  - 按钮图标（可选）
  - 提示词模板
  - 关联的LLM服务商
  - 按钮排序

- 提示词模板：
  - 支持变量 `{{selectedText}}` 代表用户选中的文本
  - 支持其他自定义变量
  - 富文本编辑器支持
  - 提示词模板导入/导出

- 工具栏管理：
  - 添加/编辑/删除按钮
  - 按钮分类管理
  - 预设模板库
  - 搜索和筛选功能
  - 按URL规则分组管理
  - 不同规则下显示不同的工具栏配置

#### 2.1.5 结果展示面板
**功能描述**：在工具栏正下方显示AI处理结果

**具体要求**：
- 面板特性：
  - 在工具栏正下方展开
  - 支持拖拽调整大小
  - 支持最小化/关闭
  - 响应式设计

- 内容展示：
  - 流式输出支持
  - Markdown渲染
  - 代码高亮
  - 复制结果功能
  - 重新生成功能

- 交互功能：
  - 对话历史记录
  - 用户反馈机制
  - 结果分享功能
  - 导出为不同格式

### 2.2 辅助功能

#### 2.2.1 设置页面
- 界面友好的配置管理
- 配置分组和搜索
- 快捷键设置
- 主题定制

#### 2.2.2 使用统计
- 功能使用次数统计
- 最常用的LLM服务商统计
- 错误率统计
- 用户行为分析

#### 2.2.3 快捷操作
- 键盘快捷键支持
- 右键菜单集成
- 浮动按钮模式

## 3. 技术规格

### 3.1 开发框架
- ** Plasmo Framework **：现代化浏览器扩展开发框架

#### Plasmo技术优势：
- **简化开发**：自动处理manifest.json和扩展打包
- **React生态**：原生支持React、Vue、Svelte等现代框架
- **TypeScript支持**：开箱即用的TypeScript和类型检查
- **热重载**：开发时实时预览和快速迭代
- **跨浏览器兼容**：一套代码支持Chrome、Firefox、Edge、Safari
- **内置工具**：ESLint、Prettier、构建优化等开箱即用
- **内容脚本优化**：简化content script开发和样式隔离
- **存储管理**：统一的storage API，支持同步和本地存储

### 3.2 技术栈
- **框架核心**：Plasmo + React + TypeScript
- **样式方案**：Tailwind CSS + CSS Modules
- **状态管理**：Zustand（轻量级状态管理）
- **HTTP客户端**：内置 fetch API + Plasmo Storage
- **构建工具**：Plasmo 内置 Vite 构建系统
- **开发工具**：ESLint + Prettier + TypeScript
- **UI组件**：Headless UI + 自定义组件库

### 3.3 数据存储
- **存储API**：Plasmo Storage（基于Chrome Storage API）
- **配置管理**：JSON格式存储在浏览器本地
- **数据同步**：浏览器内置同步（可选）
- **缓存策略**：Plasmo Storage + 内存缓存
- **数据持久化**：Chrome Extension Storage API

### 3.4 项目结构
```
agent-bar/
├── src/
│   ├── components/          # React组件
│   │   ├── Toolbar/        # 工具栏组件
│   │   ├── ResultPanel/    # 结果面板组件
│   │   └── Settings/       # 设置页面组件
│   ├── content/            # 内容脚本
│   │   ├── content.tsx     # 主内容脚本
│   │   └── content.css     # 内容脚本样式
│   ├── options/            # 选项页面
│   │   └── options.tsx     # 设置页面
│   ├── popup/              # 弹出页面
│   │   └── popup.tsx       # 插件弹出窗口
│   ├── background/         # 后台脚本
│   │   └── background.ts   # Service Worker
│   ├── hooks/              # 自定义Hooks
│   ├── stores/             # Zustand状态管理
│   ├── utils/              # 工具函数
│   │   ├── storage.ts      # 存储工具
│   │   ├── urlMatcher.ts   # URL匹配引擎
│   │   └── llmClient.ts    # LLM客户端
│   └── types/              # TypeScript类型定义
├── assets/                 # 静态资源
└── manifest.json           # 扩展清单（自动生成）
```

### 3.5 URL匹配引擎
- **匹配算法**：基于正则表达式和通配符的高性能匹配
- **规则类型**：Host匹配、Path匹配、完整URL匹配、正则表达式
- **性能优化**：缓存匹配结果、规则预处理
- **实时检测**：页面URL变化自动重新匹配
- **调试工具**：内置规则测试和调试功能

### 3.6 LLM集成架构
- **统一接口**：标准化所有LLM服务商的API调用
- **服务适配器**：每个LLM服务商的独立适配器
- **错误处理**：统一的错误处理和重试机制
- **请求管理**：请求队列和限流控制
- **响应处理**：流式响应和实时显示

## 4. 用户界面设计

### 4.1 工具栏设计
- 尺寸：高度 40px，宽度自适应
- 样式：现代化、扁平化设计
- 动画：平滑的显示/隐藏动画
- 响应式：小屏幕上自动调整布局

### 4.2 结果面板设计
- 初始尺寸：宽度 400px，高度 300px
- 可调整大小，最小尺寸限制
- 支持全屏模式
- 深色/浅色主题切换

### 4.3 URL规则配置页面设计
- 规则列表视图：表格形式展示所有规则
- 规则编辑器：模态框或侧边栏形式
- 规则测试工具：实时输入URL测试匹配结果
- 预设规则库：分类展示常用网站规则模板
- 规则分组管理：支持按用途或网站类型分组

### 4.4 设置页面设计
- 左侧导航 + 右侧内容区
- 卡片式布局
- 表单验证和实时保存
- 进度指示器
- URL规则配置集成到主导航

## 5. 用户体验设计

### 5.1 使用流程
1. 用户安装插件
2. 配置LLM服务商
3. 设置URL匹配规则
4. 自定义工具栏按钮（可按规则分组配置）
5. 浏览网页或编辑文档
6. 系统自动检测URL匹配规则
7. 选中需要处理的文本
8. 工具栏根据匹配规则显示对应按钮
9. 点击工具栏按钮
10. 查看AI处理结果
11. 根据需要继续操作

### 5.2 响应时间要求
- URL规则检测：< 10ms
- 工具栏显示：< 100ms
- API请求响应：< 30s（可配置）
- 结果展示：< 50ms
- 设置保存：< 200ms
- 规则匹配测试：< 50ms

### 5.3 错误处理
- 友好的错误提示
- 自动重试机制
- 离线模式支持
- 降级方案
- URL规则匹配失败处理
- 规则冲突检测和解决建议
- 规则语法错误实时检测

## 6. 安全与隐私

### 6.1 数据安全
- API密钥本地加密存储
- 传输数据HTTPS加密
- 不存储用户敏感文本内容
- 定期清理缓存数据

### 6.2 隐私保护
- 用户文本数据仅用于API调用
- 不向第三方发送用户数据
- 支持完全离线模式（本地LLM）
- 透明的隐私政策

## 7. 性能要求

### 7.1 响应性能
- 工具栏显示延迟 < 100ms
- 页面注入不影响主线程
- 内存使用 < 100MB
- CPU占用率 < 5%

### 7.2 可靠性
- 系统可用性 > 99.9%
- 错误恢复时间 < 5s
- 数据一致性保证
- 兼容性测试覆盖

## 8. 开发和发布计划

### 8.1 Plasmo开发环境设置
```bash
# 安装 Plasmo CLI
npm install -g plasmo

# 创建项目
plasmo init agent-bar

# 安装依赖
cd agent-bar
npm install

# 开发模式
npm run dev

# 构建生产版本
npm run build

# 打包浏览器扩展
npm run build:chrome  # Chrome
npm run build:firefox # Firefox
npm run build:edge    # Edge
```

### 8.2 MVP版本 (v1.0) - 2-3周
**核心功能**：
- Plasmo项目初始化和基础架构
- 基础LLM配置管理（OpenAI、Claude、Gemini）
- 简单工具栏组件（React + Tailwind CSS）
- 基本结果展示面板
- Chrome Extension支持（通过Plasmo构建）
- 基础URL匹配规则（host匹配）
- 简单的设置页面界面

**技术实现**：
- Plasmo Framework + React + TypeScript
- Zustand状态管理
- Plasmo Storage本地存储
- Tailwind CSS样式
- 基础的content script注入

### 8.3 完整版本 (v2.0) - 4-6周
**功能增强**：
- 全功能LLM配置管理（DeepSeek、Qwen、GLM等）
- 完整URL匹配规则（host+URI、通配符、正则表达式）
- 规则分组和优先级管理
- 规则测试工具和实时预览
- 预设规则库（GitHub、Stack Overflow、文档站点等）
- 高级UI/UX设计
- 多浏览器支持（Chrome、Firefox、Edge）
- 响应式设计和主题切换

**技术升级**：
- 高性能URL匹配引擎
- 高级React组件库
- 统一的LLM API适配器
- 错误处理和重试机制
- 性能监控和分析

### 8.4 扩展版本 (v3.0) - 6-8周
**高级功能**：
- 团队协作功能
- 云端配置同步
- 插件市场和模板分享
- 企业版功能（SSO、权限管理）
- 智能规则推荐引擎
- 高级分析和统计仪表板
- API请求调试工具
- 批量处理功能

**架构优化**：
- 微前端架构
- 高可用性设计
- 性能优化和监控
- 国际化支持
- 可访问性增强

### 8.5 发布和维护
**发布流程**：
1. **开发测试**：本地开发和功能测试
2. **浏览器商店审核**：Chrome Web Store、Firefox Add-ons
3. **版本发布**：自动更新和版本管理
4. **用户反馈**：收集和处理用户反馈
5. **持续迭代**：功能改进和性能优化

**维护计划**：
- 定期安全更新
- LLM服务商API适配更新
- 浏览器兼容性维护
- 性能监控和优化
- 用户支持和文档更新

## 9. 成功指标

### 9.1 用户指标
- 日活跃用户数 (DAU)
- 用户留存率
- 平均使用时长
- 功能使用率

### 9.2 技术指标
- 系统响应时间
- 错误率
- 崩溃率
- 资源使用率

### 9.3 业务指标
- 用户满意度评分
- 功能完成率
- 转化率
- 支持请求数量

## 10. 风险与挑战

### 10.1 技术风险
- 不同LLM API兼容性
- 性能优化挑战
- 跨平台兼容性
- 第三方依赖风险

### 10.2 产品风险
- 用户接受度
- 竞争对手压力
- 需求变更频率
- 维护成本

### 10.3 缓解策略
- 充分的技术调研
- 敏捷开发和快速迭代
- 用户反馈收集
- 持续的性能优化

---

**文档版本**: 1.0
**创建日期**: 2025-11-18
**最后更新**: 2025-11-18
**负责人**: 产品团队